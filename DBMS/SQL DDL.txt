CREATE DATABASE CollegeLibrary;
USE CollegeLibrary;

CREATE TABLE Student (
    StudentID INT PRIMARY KEY,
    Name VARCHAR(50) NOT NULL,
    Department VARCHAR(30),
    Year INT CHECK (Year BETWEEN 1 AND 4),
    Email VARCHAR(50) UNIQUE
);

CREATE TABLE Book (
    BookID INT PRIMARY KEY,
    Title VARCHAR(100) NOT NULL,
    Author VARCHAR(50),
    Publisher VARCHAR(50),
    Price DECIMAL(8,2) CHECK (Price > 0),
    Availability CHAR(1) DEFAULT 'Y'
);

CREATE TABLE Transaction (
    TransID INT AUTO_INCREMENT PRIMARY KEY,
    StudentID INT,
    BookID INT,
    IssueDate DATE NOT NULL,
    ReturnDate DATE,
    Status VARCHAR(10) CHECK (Status IN ('Issued', 'Returned')),
    FOREIGN KEY (StudentID) REFERENCES Student(StudentID),
    FOREIGN KEY (BookID) REFERENCES Book(BookID)
);

CREATE VIEW Issued_Books AS
SELECT S.Name AS StudentName, B.Title AS BookTitle, T.IssueDate, T.Status
FROM Transaction T
JOIN Student S ON T.StudentID = S.StudentID
JOIN Book B ON T.BookID = B.BookID
WHERE T.Status = 'Issued';

CREATE INDEX idx_book_title ON Book (Title);

CREATE VIEW LibBook AS SELECT * FROM Book;

INSERT INTO Student VALUES (1, 'Amit Sharma', 'Computer', 3, 'amit@gmail.com');
INSERT INTO Student VALUES (2, 'Sneha Patil', 'IT', 2, 'sneha@gmail.com');

INSERT INTO Book VALUES (101, 'Database Systems', 'Elmasri', 'Pearson', 550.00, 'Y');
INSERT INTO Book VALUES (102, 'Operating Systems', 'Silberschatz', 'Wiley', 620.00, 'Y');

INSERT INTO Transaction (StudentID, BookID, IssueDate, Status)
VALUES (1, 101, CURDATE(), 'Issued');

SELECT * FROM Issued_Books;
